<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Report Item | Warrior's Trail</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      width: 100%;
      height: 600px;
      margin-bottom: 20px;
    }
    .form-control {
      margin-bottom: 8px;
      width: 100%;
      box-sizing: border-box;
      padding: 6px;
    }
    .leaflet-container {
      cursor: crosshair;
    }
    .item-form {
      max-width: 360px;
      margin-bottom: 18px;
    }
    .item-form label {
      font-weight: bold;
      display: block;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h2>Report Lost or Found Item</h2>
  <div>Mark campus location and submit item details below</div>
  <div id="map"></div>
  <form id="itemForm" class="item-form">
    <label for="itemType">Type:</label>
    <select id="itemType" class="form-control" required>
      <option value="Phone">Phone</option>
      <option value="Wallet">Wallet</option>
      <option value="Keys">Keys</option>
      <option value="Other">Other</option>
    </select>

    <label for="itemName">Item Name:</label>
    <input id="itemName" class="form-control" required />

    <label for="itemDesc">Description:</label>
    <input id="itemDesc" class="form-control" />

    <label for="itemContact">Contact:</label>
    <input id="itemContact" class="form-control" required />

    <input type="hidden" id="itemLat" />
    <input type="hidden" id="itemLng" />

    <button type="submit" class="form-control" style="background:#2d8be0;color:#fff;">Submit Report</button>
  </form>

  <div id="reportResult"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Firebase SDKs for web projects (compatible, not module imports) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script>
    // Your Firebase web app's configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCyJwAGiPmDWl6tYhm_nV_EJMkoZIrxKXg",
      authDomain: "warriorstrail-9c05b.firebaseapp.com",
      databaseURL: "https://warriorstrail-9c05b-default-rtdb.firebaseio.com",
      projectId: "warriorstrail-9c05b",
      storageBucket: "warriorstrail-9c05b.firebasestorage.app",
      messagingSenderId: "187592091783",
      appId: "1:187592091783:web:cb8ce312d1026e0f4fb022",
      measurementId: "G-0LQHP3VVZN"
    };
    // Initialize Firebase (compatibility syntax)
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    // Note: analytics is not used for form/report functions, you can add it if needed
  </script>
  <script>
    var imgWidth = 1118; // campus image width
    var imgHeight = 768; // campus image height

    var map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 2,
      zoom: 0,
      center: [imgHeight/2, imgWidth/2]
    });

    var bounds = [[0,0], [imgHeight, imgWidth]];
    var image = L.imageOverlay('img/image.jpg', bounds).addTo(map);
    map.fitBounds(bounds);

    var marker;

    map.on('click', function(e) {
      if(marker) map.removeLayer(marker);
      marker = L.marker(e.latlng).addTo(map);
      document.getElementById('itemLat').value = Math.round(e.latlng.lat);
      document.getElementById('itemLng').value = Math.round(e.latlng.lng);
    });

    document.getElementById('itemForm').onsubmit = function(event) {
      event.preventDefault();
      let type = document.getElementById('itemType').value;
      let name = document.getElementById('itemName').value.trim();
      let desc = document.getElementById('itemDesc').value.trim();
      let contact = document.getElementById('itemContact').value.trim();
      let lat = document.getElementById('itemLat').value;
      let lng = document.getElementById('itemLng').value;

      if(!lat || !lng) {
        alert('Click the map to pin the item location!');
        return;
      }

      const newReport = {
        type,
        itemName: name,
        description: desc,
        contact,
        lat: parseFloat(lat),
        lng: parseFloat(lng),
        timestamp: Date.now()
      };

      // Save to Firebase (auto-sync for map.html to fetch!)
      db.ref("items").push(newReport, function(error) {
        if (error) {
          alert('Error submitting your report. Try again!');
        } else {
          document.getElementById('reportResult').innerHTML =
            `<b>Report submitted!</b><br>` +
            `Type: ${type}<br>` +
            `Name: ${name}<br>` +
            `Description: ${desc}<br>` +
            `Contact: ${contact}<br>` +
            `Pinned Location: Y=${lat}, X=${lng}`;
          event.target.reset();
          if(marker) map.removeLayer(marker);
        }
      });
    };
  </script>
</body>
</html>
